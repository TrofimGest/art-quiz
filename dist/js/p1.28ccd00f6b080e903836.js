(()=>{"use strict";const e=class{constructor(){this.start={}}async render(){const e=await fetch("./views/start.html");return await e.text()}async afterRender(){const e=document.querySelectorAll(".start__btn");for(let t=0;t<e.length;t+=1)e[t].addEventListener("click",(()=>{localStorage.setItem("game",t)}))}},t=()=>{const e=(location.hash.slice(1).toLowerCase()||"/").split("/"),t={resource:null,id:null,verb:null};return t.resource=e[0],t.id=e[1],t.verb=e[2],t},s=e=>new Promise((t=>setTimeout(t,e))),r={"/":e,"/category":class{constructor(){this.category={},this.categoryArr=["Realism","Impressionism","Religion","Portrait","Marine","Renaissance","Landscape","Avant-garde","Surrealism","Romanticism"]}async render(){const e=await fetch("./views/category.html");return await e.text()}async afterRender(){const e=document.querySelectorAll(".category__block"),t=document.querySelectorAll(".category__btn");for(let e=0;e<t.length;e+=1)t[e].addEventListener("click",(()=>{localStorage.setItem("category",this.categoryArr[e])}));this.getScore(e)}getScore(e){for(let t=0;t<this.categoryArr.length;t+=1){const s=localStorage.getItem(`${this.categoryArr[t]}`);s&&(document.getElementById(`${this.categoryArr[t]}`).innerText=`${s}/10`,e[t].classList.add("played"))}}},"/quiz":class{constructor(){this.quiz={},this.questions=[],this.imgDataset=[],this.totalAmount=10,this.answeredAmount=0}async render(){const e=(localStorage.getItem("game"),"./views/quiz.html"),t=await fetch(e),s=await t.text();return this.imgDataset=await this.startGame(),s}async afterRender(){const e=[document.querySelector("#a1"),document.querySelector("#a2"),document.querySelector("#a3"),document.querySelector("#a4")],t=document.querySelectorAll(".quiz__dot"),s=document.querySelector(".quiz__modal"),r=document.querySelector(".quiz__skip-btn"),o=document.querySelector(".quiz__modal-type");this.questions=await this.setQuestions();for(let r=0;r<e.length;r+=1)e[r].addEventListener("click",(()=>this.nextQuestion(e[r],t,s,o)));r.addEventListener("click",(()=>this.toggleMenu(s))),this.renderQuestion()}async setQuestions(){return Promise.all(this.imgDataset.map((async e=>new class{constructor(e,t){this.pictureEl=document.querySelector(".quiz__img-img"),this.modalAuthor=document.querySelector(".quiz__modal-author"),this.modalYear=document.querySelector(".quiz__modal-year"),this.modalName=document.querySelector(".quiz__modal-name"),this.modalImg=document.querySelector(".quiz__modal-img"),this.answerElements=[document.querySelector("#a1"),document.querySelector("#a2"),document.querySelector("#a3"),document.querySelector("#a4")],this.picName=e.name,this.picYear=e.year,this.pictureElem=e.imageNum,this.correctAnswer=e.author,this.isCorrect=!1,t.push(this.correctAnswer),this.answers=this.shuffleAnswers(t)}shuffleAnswers(e){const t=e;for(let e=t.length-1;e>0;e-=1){const s=Math.floor(Math.random()*e),r=t[e];t[e]=t[s],t[s]=r}return t}checkAnswer(e){this.isCorrect=e.childNodes[1].textContent===this.correctAnswer}fillModal(){this.modalAuthor.innerHTML=this.correctAnswer,this.modalYear.innerHTML=this.picYear,this.modalName.innerHTML=this.picName,this.modalImg.src=`https://raw.githubusercontent.com/TrofimGest/image-data/master/img/${this.pictureElem}.jpg`}getImage(){const e=new Image;e.src=`https://raw.githubusercontent.com/TrofimGest/image-data/master/img/${this.pictureElem}.jpg`,e.onload=()=>{this.pictureEl.style.backgroundImage=`url(https://raw.githubusercontent.com/TrofimGest/image-data/master/img/${this.pictureElem}.jpg)`}}render(){this.answerElements.forEach(((e,t)=>{e.innerHTML=`<input type="radio" name="radio"><span class="checkmark">${this.answers[t]}</span>`,this.getImage()}))}}(e,await this.getIncorrect()))))}async getIncorrect(){try{const e="./images.json",t=await fetch(e),s=await t.json(),r=[];for(let e=0;e<3;e+=1){const e=s.images[Math.floor(241*Math.random())];r.push(e.author)}return r}catch(e){return alert(e),1}}renderQuestion(){this.questions[this.answeredAmount].render()}nextQuestion(e,t,s,r){(e.firstChild.checked||"incorrect__label"===e.id)&&(this.questions[this.answeredAmount].checkAnswer(e),this.showResult(t,r),this.toggleMenu(s),this.questions[this.answeredAmount].fillModal(),this.answeredAmount+=1)}showResult(e,t){this.questions[this.answeredAmount].isCorrect?(e[this.answeredAmount].classList.add("quiz__correct"),t.innerText="Правильно :)"):(e[this.answeredAmount].classList.add("quiz__incorrect"),t.innerText="Не правильно! Это:")}endGame(){const e=this.calculateCorrectAnswers();localStorage.setItem("correctAnswers",e),window.location.hash="#final"}async startGame(){try{const e="./images.json",t=localStorage.getItem("category")||"portrait",s=await fetch(e);return(await s.json()).images.filter((e=>e.category===t.toLowerCase())).slice(0,10)}catch(e){return 1}}toggleMenu(e){e.classList.toggle("show-menu"),this.answeredAmount<this.totalAmount?this.renderQuestion():this.endGame()}calculateCorrectAnswers(){let e=0;return this.questions.forEach((t=>{t.isCorrect&&(e+=1)})),e}},"/start":e,"/settings":class{constructor(){this.settings={},this.lastVolume=.5,this.isPlaying=!1}async render(){const e=await fetch("./views/settings.html");return await e.text()}async afterRender(){const e=document.querySelector(".audio1"),t=document.getElementById("volume-text"),s=document.querySelector(".settings__btn-container"),r=document.querySelector(".settings__type"),o=document.querySelector(".volume"),a=document.querySelector(".volume__mousemove-container"),n=document.getElementById("volume-progress-container1"),i=document.getElementById("volume-progress1"),c=document.getElementById("v1");this.quiz={},s.addEventListener("click",(()=>this.isPlaying?this.pauseMusic(e,s,o,r,t):this.playMusic(e,s,o,r,t))),a.addEventListener("mousemove",(()=>this.changeVolume(event,e,i,n,c))),c.addEventListener("click",(()=>this.mute(e,i,c)))}playMusic(e,t,s,r,o){this.isPlaying=!0,t.style.background="var(--white-color)",r.innerText="Выключить музыку",r.style.color="var(--black-color)",e.play(),s.style.opacity="1",o.style.opacity="1"}pauseMusic(e,t,s,r,o){this.isPlaying=!1,t.style.background="var(--main-color)",r.innerText="Включить музыку",r.style.color="var(--white-color)",s.style.opacity="0",o.style.opacity="0",e.pause()}changeVolume(e,t,s,r){const o=s,a=t;let n=e.offsetX/r.offsetWidth;n<.05&&(n=0),n>.95&&(n=1),o.style.width=100*n+"%",a.volume=n,this.lastVolume=n}mute(e,t,s){const r=t,o=e;e.volume?(this.lastVolume=e.volume,o.volume=0,r.style.width=0,s.classList.replace("bxs-volume-full","bxs-volume-mute")):(o.volume=this.lastVolume,r.style.width=100*this.lastVolume+"%",s.classList.replace("bxs-volume-mute","bxs-volume-full"))}},"/final":class{constructor(){this.final={}}async render(){const e=await fetch("./views/final.html");return await e.text()}async afterRender(){const e=localStorage.getItem("correctAnswers"),t=localStorage.getItem("category");this.showResult(e,t)}showResult(e,t){localStorage.setItem(`${t}`,e),document.querySelector(".final__score").innerText=`${e}/10`}}},o=async()=>{const e=document.getElementById("app"),o=t(),a=(o.resource?`/${o.resource}`:"/")+(o.id?"/:id":"")+(o.verb?`/${o.verb}`:""),n=new(0,r[a]);e.classList.add("transition"),await s(300),e.innerHTML=await n.render(),e.classList.remove("transition"),await n.afterRender()};window.addEventListener("hashchange",o),window.addEventListener("load",o),document.addEventListener("load",(()=>{document.querySelector(".audio1").play()}))})();